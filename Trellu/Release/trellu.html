<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trellu</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <style>
        body{background:#3a8cd0}body.fixed-navbar{padding-top:65px}@media(max-width:979px){body.fixed-navbar{padding-top:0}}.card{background:#fff;padding:8px;padding-bottom:12px;border-radius:6px;margin-bottom:4px;cursor:pointer;max-width:300px;min-height:20px}.card .title{word-wrap:break-word}.card .remove{margin-right:15px}.list{min-height:500px;margin-top:5px;min-width:300px;max-width:340px;padding:0 15px}.list .header{overflow:hidden}.cardlist{min-height:100px;background:#eee;border-radius:6px;padding:0 10px 10px 10px}.cardlist .list-name{cursor:pointer;overflow-x:hidden;max-width:100%;font-weight:bold}.cardlist .list-actions .btn{margin-top:8px}.cardlist .drop-area{min-height:30px;padding-bottom:10px}.cardlist .drop-area:hover.accept-drop-started{padding-bottom:40px}button .result:not(:empty){margin-left:4px}.navbar-nav button{margin-top:8px}.cardlist-container{white-space:nowrap;overflow-x:auto;padding-bottom:16px}.cardlist-container>div{float:none !important;display:inline-block;vertical-align:top}.accept-drop-started{box-shadow:0 0 3pt 2pt yellow}.accept-drop-hover{box-shadow:0 0 0 2pt yellow}
    </style>

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        var Button = function () { function n() { } return n.prototype.To$ = function () { var n = $("<button>").attr("type", "button").addClass("btn " + this.Class), t, i; return this.Image && (t = $("<span>").addClass("glyphicon glyphicon-" + this.Image).attr("aria-hidden", "true"), n.append(t)), i = $("<span>").addClass("result").html(this.Text), n.append(i), n.click(this.Command), this.Data && n.data(this.Data), n }, n }(), DateTime = function () { function n() { } return n.Format = function (n) { var t = n % 1e3, i = Math.floor(n / 1e3 % 60), r = Math.floor(n / 6e4 % 60), u = Math.floor(n / 36e5 % 60); return ("0" + u).slice(-2) + ":" + ("0" + r).slice(-2) + ":" + ("0" + i).slice(-2) + "." + t }, n }(), Guid = function () { function n() { } return n.ComposeBytes = function () { return Math.floor((1 + Math.random()) * 65536).toString(16).substring(1) }, n.NewGuid = function () { return n.ComposeBytes() + n.ComposeBytes() + "-" + n.ComposeBytes() + "-" + n.ComposeBytes() + "-" + n.ComposeBytes() + "-" + n.ComposeBytes() + n.ComposeBytes() + n.ComposeBytes() }, n }(), Card = function () { function n(n) { n === void 0 && (n = null); for (var t in n) this[t] = n[t] } return n.InitializeComponent = function () { $(document).on("click", ".cardlist .action-add", function () { var r, i, t; (r = prompt("Name")) && (i = $(this).closest(".cardlist").find(".drop-area"), t = new n, t.ListID = $(this).closest(".list").data("id"), t.Name = r, t.Description = "Test", t.Milliseconds = 0, t.Order = i.find(".card").length, t.AddOrUpdate(), i.append(t.To$())) }); $(window).on("beforeunload", function () { if ($(".card .time").filter(function () { return $(this).data("started") }).length) return "There are running timers." }); $(function () { var t = n.Load().AsLinq().OrderBy(function (n) { return n.Order }).ToArray(); $.each(t, function (t, i) { var r = new n(i); $(".list").filter(function (n, t) { return $(t).data("id") == r.ListID }).find(".cardlist .drop-area").append(r.To$()) }) }) }, n.GetStorage = function () { return JSON.parse(localStorage.getItem("Cards")) || {} }, n.Load = function () { var t = n.GetStorage(), i = []; for (var r in t) i.push(t[r]); return i }, n.Save = function (n) { if (n instanceof Array) { var t = {}; $.each(n, function (n, i) { t[i.ID] = i }); n = t } localStorage.setItem("Cards", JSON.stringify(n)) }, n.prototype.AddOrUpdate = function () { var t = n.GetStorage(); if (!this.ID) do this.ID = Guid.NewGuid(); while (t[this.ID]); console.log(this); t[this.ID] = this; n.Save(t) }, n.prototype.Remove = function () { var t = n.GetStorage(); delete t[this.ID]; n.Save(t) }, n.prototype.To$ = function () { var t = this, u = $("<div>").addClass("card").data("id", t.ID), e = $("<span>").addClass("title col-md-10").attr("title", this.Name).append(this.Name), i, r, f; return e.click(function () { var n; (n = prompt("Name", t.Name)) && (e.html(n), t.Name = n, t.AddOrUpdate()) }), i = new Button, i.Image = "time", i.Class = "btn-default btn-xs time", i.Text = DateTime.Format(this.Milliseconds), i.Data = { ms: this.Milliseconds }, i.Command = function () { var o = this, r = $(this).data("started"), i, f, e, u; r = new Date(r); (isNaN(r.valueOf()) || !r.getTime()) && (r = null); i = parseInt($(this).data("ms")); isNaN(i) && (i = 0); r ? ($(this).css("background", ""), f = $(this).data("updateInterval"), clearInterval(f), $(this).removeData("updateInterval"), e = (new Date).getTime() - r.getTime(), i += e, $(this).data("ms", i), $(this).removeData("started"), $(this).find(".result").html(DateTime.Format(i)), u = n.Load().AsLinq().FirstOrDefault(function (n) { return n.ID == t.ID }), u && (u = new n(u)), u = u || t, t.Milliseconds = i, u.Milliseconds = i, u.AddOrUpdate(), console.log("Total ms: ", i, DateTime.Format(i))) : (r = new Date, $(this).css("background", "#FFFF3E"), $(this).data("started", r.getTime()), f = setInterval(function () { var n = (new Date).getTime() - r.getTime(); $(o).find(".result").html(DateTime.Format(n + i)) }), $(this).data("updateInterval", f)) }, r = new Button, r.Image = "remove", r.Class = "btn-default btn-xs", r.Command = function () { var i = "Are you sure you want to delete '" + t.Name + "'?\nRecorded time: " + DateTime.Format(t.Milliseconds), n; confirm(i) && (t.Remove(), n = $(this).closest(".card").find(".time").data("updateInterval"), clearInterval(n), $(this).closest(".card").remove()) }, f = $("<div>").addClass("row"), f.append(r.To$().wrap("<div>").parent().addClass("pull-right remove")), f.append(e), u.append(f), u.append(i.To$().wrap("<div>").parent()), u.draggable({ cursor: "move", revert: "invalid", connectToSortable: ".cardlist .drop-area" }), u }, n }(), TSLinq, CardList; $(function () { Card.InitializeComponent() }), function (n) { var t = function () { function n(n) { n === void 0 && (n = []); this.a = n; Object.defineProperty(this, "a", { value: n, writable: !1 }) } return n.prototype.Aggregate = function (n) { var t, i, r, u; if ((t = this.a).length === 0) throw "Aggregate of empty array"; for (i = t[0], r = 1, u = t.length; r < u; ++r) i = n(i, t[r]); return i }, n.prototype.All = function (n) { for (var i = this.a, t = 0, r = i.length; t < r; ++t) if (!n(i[t])) return !1; return !0 }, n.prototype.Any = function (n) { for (var i = this.a, t = 0, r = i.length; t < r; ++t) if (n(i[t])) return !0; return !1 }, n.prototype.Average = function (n) { var u = this.a, i, r, t; for (n = n || function (n) { return n }, i = 0, r = u.length, t = 0; t < r; ++t) i += n(u[t]); return i / r }, n.prototype.Concat = function (t) { return new n(this.a.concat(t)) }, n.prototype.Contains = function (n, t) { return t ? this.Any(function (i) { return t.Equals(i, n) }) : this.Any(function (t) { return t === n }) }, n.prototype.Count = function (n) { return n ? this.Where(n).Count() : this.a.length }, n.prototype.Distinct = function (n) { return this.DistinctBy(function (n) { return n }, n) }, n.prototype.DistinctBy = function (t, i) { for (var f, e = this.a, r, o = [], s = [], u = 0, h = e.length; u < h; ++u) r = e[u], f = t(r), o.AsLinq().Contains(f, i) || (o.push(f), s.push(r)); return new n(s) }, n.prototype.ElementAt = function (n) { if (n < 0 || n >= this.a.length) throw "Index was out of range. Must be non-negative and less than the size of the collection."; return this.a[n] }, n.prototype.ElementAtOrDefault = function (n, t) { return n >= this.a.length || n < 0 ? t : this.a[n] }, n.prototype.Except = function (t, i) { for (var e = this.a, o = [], s = {}, u, h, c = i ? i.GetHashCode : function (n) { return Object.GetHashCode(n) }, r = 0, f = t.length; r < f; ++r) s[c(t[r])] = 1; for (r = 0, f = e.length; r < f; ++r) u = e[r], h = c(u), s[h] || o.push(u); return new n(o) }, n.prototype.First = function (n) { if (this.a.length === 0) throw "Enumeration does not contain elements"; if (!n) return this.a[0]; var t = this.Where(n); if (t.Count() === 0) throw "Enumeration does not contain elements"; return t.ElementAt(0) }, n.prototype.FirstOrDefault = function (n, t) { return n ? this.Where(n).ElementAtOrDefault(0, t) : this.a.length > 0 ? this.a[0] : t }, n.prototype.ForEach = function (n) { for (var i = this.a, t = 0, r = i.length; t < r; ++t) if (n(i[t], t) === !1) break }, n.prototype.GroupBy = function (t, i, r) { var s, h, u, o, e, l, a, f, c; for (i = i || function (n) { return n }, r = r || { Equals: function (n, t) { return n == t }, GetHashCode: function (n) { return Object.GetHashCode(n) } }, s = this.a, e = {}, f = 0, c = s.length; f < c; ++f) o = undefined, h = t(s[f]), u = r.GetHashCode(h), typeof e[u] != "undefined" && (o = r.Equals(h, e[u].Key) ? u : u + f), typeof o != "undefined" && o !== u && (u = o), e[u] = e[u] || { Key: h, Elements: [] }, e[u].Elements.push(i(s[f])); for (l = Object.keys(e), a = [], f = 0, c = l.length; f < c; ++f) a.push(e[l[f]]); return new n(a) }, n.prototype.IndexOf = function (n, t) { var r = this.a, f, i, u; if (t) { for (i = 0, u = r.length; i < u; ++i) if (f = r[i], t.Equals(f, n)) return i } else for (i = 0, u = r.length; i < u; ++i) if (r[i] === n) return i; return -1 }, n.prototype.Intersect = function (t, i) { for (var u = [], r = 0, f = t.length; r < f; ++r) this.Contains(t[r], i) && u.push(t[r]); return new n(u) }, n.prototype.Join = function (t, i, r, u, f) { for (var o, s, a, h = [], c = this.Select(i), l = t.AsLinq().Select(r), e = 0, v = c.Count() ; e < v; ++e) o = c.ElementAt(e), s = -1, (s = l.IndexOf(o, f)) != -1 && (a = l.ElementAt(s), h.push(u(o, a))); return new n(h) }, n.prototype.Last = function (n) { if (this.a.length === 0) throw "Enumeration does not contain elements"; if (!n) return this.a[this.a.length - 1]; var t = this.Where(n); if (t.Count() === 0) throw "Enumeration does not contain elements"; return t.Last() }, n.prototype.LastOrDefault = function (n, t) { if (this.a.length === 0) return t; if (!n) return this.a[this.a.length - 1]; var i = this.Where(n); return i.Count() === 0 ? t : i.LastOrDefault(null, t) }, n.prototype.Max = function (n) { var t = this.a, i, r, f, u; if (t.length === 0) throw "Sequence contains no elements."; for (n = n || function (n) { return n }, i = n(t[0]), r = 0, f = t.length; r < f; ++r) u = n(t[r]), u > i && (i = u); return i }, n.prototype.Min = function (n) { var t = this.a, i, r, f, u; if (t.length === 0) throw "Sequence contains no elements."; for (n = n || function (n) { return n }, i = n(t[0]), r = 0, f = t.length; r < f; ++r) u = n(t[r]), u < i && (i = u); return i }, n.prototype.OrderBy = function (n, t) { return t = t || function (n, t) { return n > t ? 1 : -1 }, this.a.sort(function (i, r) { return t(n(i), n(r)) }), this }, n.prototype.OrderByDescending = function (n, t) { return t = t || function (n, t) { return n > t ? 1 : -1 }, t = function (n) { return function (t, i) { return -n(t, i) } }(t), this.a.sort(function (i, r) { return t(n(i), n(r)) }), this }, n.prototype.Reverse = function () { for (var i, n = this.a.length - 1, t = 0; t < n; ++t, --n) i = this.a[t], this.a[t] = this.a[n], this.a[n] = i; return this }, n.prototype.Select = function (t) { for (var r = this.a, u = [], i = 0, f = r.length; i < f; ++i) u.push(t(r[i])); return new n(u) }, n.prototype.SelectMany = function (n, t) { for (var u = this.a, i = [], r = 0, f = u.length; r < f; ++r) i = i.concat(n(u[r])); return t ? i.AsLinq().Select(t) : i.AsLinq() }, n.prototype.SequenceEqual = function (n, t) { var r = this.a, i, u; if (typeof r == "undefined" || typeof n == "undefined") throw "Do not pass null values to arrays."; if (r === n) return !0; if (r.length !== n.length) return !1; if (t) { for (i = 0, u = r.length; i < u; i++) if (!t(r[i], n[i])) return !1 } else for (i = 0, u = r.length; i < u; i++) if (r[i] !== n[i]) return !1; return !0 }, n.prototype.Single = function (n) { var t = this.a, r, i, u; if (!n) { if (t.length != 1) throw "Source has none or more than one element"; return t[0] } for (r = null, i = 0, u = t.length; i < u; ++i) if (n(t[i])) { if (r != null) throw "Source has more than one element"; r = t[i] } return r }, n.prototype.SingleOrDefault = function (n, t) { var i = this.a, u, r, f; if (!n) return i.length != 1 ? t : i[0]; for (u = null, r = 0, f = i.length; r < f; ++r) if (n(i[r])) { if (u != null) return t; u = i[r] } return u }, n.prototype.Skip = function (t) { return new n(this.a.slice(t)) }, n.prototype.SkipWhile = function (t) { for (var r = this.a, i = 0, u = r.length; i < u; ++i) if (t(r[i]) === !1) break; return new n(r.slice(i)) }, n.prototype.Sum = function (n) { var i = this.a, u = 0, t, r; if (n) for (t = 0, r = i.length; t < r; ++t) u += n(i[t]); else for (t = 0, r = i.length; t < r; ++t) u += i[t]; return u }, n.prototype.Take = function (t) { for (var u = this.a, f = [], i = t > (i = u.length) ? i : t, r = 0; r < i; ++r) f.push(u[r]); return new n(f) }, n.prototype.TakeWhile = function (t) { for (var u = this.a, f = [], i = 0, e = u.length, r; i < e; ++i) if (r = u[i], t(r)) f.push(r); else break; return new n(f) }, n.prototype.Union = function (t, i) { for (var h = this.a, o = [], e = {}, r, f, c = i ? i.GetHashCode : function (n) { return Object.GetHashCode(n) }, u = 0, s = h.length; u < s; ++u) r = h[u], f = c(r), e[f] || (e[f] = r, o.push(r)); for (u = 0, s = t.length; u < s; ++u) r = t[u], f = c(r), e[f] || (e[f] = r, o.push(r)); return new n(o) }, n.prototype.Where = function (t) { for (var u = this.a, i, f = [], r = 0, e = u.length; r < e; ++r) i = u[r], t(i) && f.push(i); return new n(f) }, n.prototype.Zip = function (t, i) { for (var u = this.a, f = [], e = u.length > t.length ? t.length : u.length, r = 0, o = e; r < o; ++r) f.push(i(u[r], t[r])); return new n(f) }, n.prototype.ToArray = function () { return this.a }, n }(); n.Linq = t }(TSLinq || (TSLinq = {})); Array.prototype.AsLinq = function () { return new TSLinq.Linq(this) }; Object.GetHashCode = function (n) { var i, t, r; if (n instanceof Number) return Number.GetHashCode(n); if (i = n instanceof Object ? JSON.StringifyNonCircular(n) : n.toString(), t = 0, i.length === 0) return t; for (r = 0; r < i.length; ++r) t = (t << 5) - t + i.charCodeAt(r); return t }; Number.GetHashCode = function (n) { return n.valueOf() }; Object.IsPlain = function (n) { return typeof n != "object" || n.nodeType || n instanceof Window || n.constructor && !{}.hasOwnProperty.call(n.constructor.prototype, "isPrototypeOf") ? !1 : !0 }; JSON.StringifyNonCircular = function (n) { var r = r || "", i, t; for (i in n) t = n[i], r += t && (t instanceof Array || t.IsPlain()) ? i + ":" + JSON.stringify(t) : t && typeof t == "object" ? i + ":$ref#" + t : i + ":" + t; return r }; CardList = function () { function n(n) { n === void 0 && (n = null); for (var t in n) this[t] = n[t] } return n.InitializeComponent = function () { function t() { $(".drop-area").sortable({ items: ".card", connectWith: ".drop-area", receive: function (n, t) { var f = t.item.data("id"), i; if (f) { var e = $(this).closest(".list").data("id"), o = t.item.index(), u = Card.Load(), r = u.AsLinq().Single(function (n) { return n.ID == f }); r.ListID = e; r.Order = o; new Card(r).AddOrUpdate(); i = 0; u = Card.Load().AsLinq().OrderBy(function (n) { return n.Order }).Select(function (n) { return n.ListID == e && n.ID != r.ID && (i == o && ++i, n.Order = i, ++i), new Card(n) }).ToArray(); Card.Save(u) } } }).droppable({ accept: ".card", activeClass: "accept-drop-started" }) } $(document).on("click", ".lists-menu .action-add", function () { var r, u, i; (r = prompt("Title")) && (u = $(".cardlist-container"), i = new n, i.Name = r, i.AddOrUpdate(), u.append(i.To$()), $(".drop-area.ui-sortable[data-ui-sortable]").sortable("destroy"), $(".drop-area.ui-droppable[data-ui-droppable]").sortable("destroy"), t()) }); $(function () { var i = n.Load(); $.each(i, function (t, i) { var r = new n(i); $(".cardlist-container").append(r.To$()) }); t() }) }, n.prototype.Save = function (n) { localStorage.setItem("CardLists", JSON.stringify(n)) }, n.prototype.AddOrUpdate = function () { var t = n.GetStorage(); if (!this.ID) do this.ID = Guid.NewGuid(); while (t[this.ID]); t[this.ID] = this; this.Save(t) }, n.prototype.Remove = function () { var i = this, t = n.GetStorage(), r = Card.Load(); r.AsLinq().Where(function (n) { return n.ListID == i.ID }).ForEach(function (n) { new Card(n).Remove() }); delete t[this.ID]; this.Save(t) }, n.GetStorage = function () { return JSON.parse(localStorage.getItem("CardLists")) || {} }, n.Load = function () { var t = n.GetStorage(), i = []; for (var r in t) i.push(t[r]); return i }, n.prototype.To$ = function () { var n = this, o = $("<div>").addClass("list").data("id", n.ID), r = $("<div>").addClass("accept-droppable cardlist"), u = $("<h4>").addClass("list-name").html(this.Name), t, s; u.click(function () { var t; (t = prompt("Name", n.Name)) && (u.html(t), n.Name = t, n.AddOrUpdate()) }); var f = $("<div>").addClass("header"), e = $("<div>").addClass("list-actions pull-right"), i = new Button; return i.Class = "btn-default btn-xs action-add", i.Image = "plus", i.Text = "Add", t = new Button, t.Class = "btn-default btn-xs action-remove", t.Image = "remove", t.Command = function () { var i = "Are you sure you want to delete '" + n.Name + "'?\nAll cards in this list will be lost.", t; confirm(i) && (n.Remove(), t = $(this).find(".time"), t.each(function () { var n = $(this).data("updateInterval"); clearInterval(n) }), $(this).closest(".list").remove()) }, s = $("<div>").addClass("drop-area"), e.append(i.To$()), e.append(t.To$()), f.append(e), f.append(u), r.append(f), r.append(s), o.append(r), o }, n }(); CardList.InitializeComponent();
    </script>
</head>
<body>
    <div class="navbar navbar-static-top navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="/" class="navbar-brand">Trellu</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="lists-menu">
                        <button class="btn btn-default action-add">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                            Add list
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container-fluid body-content">
        <div class="row cardlist-container"></div>
    </div>
</body>
</html>